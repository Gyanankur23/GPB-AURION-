<script>
const chatContent = document.getElementById("chat-content");
const chatForm = document.getElementById("chat-form");
const userInput = document.getElementById("user-input");

function createMessageElement(message, fromUser) {
    const messageElement = document.createElement("div");
    messageElement.classList.add("max-w-md", "break-words", "px-4", "py-2", "rounded-full");
    messageElement.classList.add(fromUser ? "bg-blue-500" : "bg-white");
    messageElement.classList.add(fromUser ? "text-white" : "text-gray-800");
    messageElement.classList.add(fromUser ? "ml-auto" : "mr-auto");
    messageElement.textContent = message;
    return messageElement;
}

async function fetchResponse(userMessage) {
    try {
        const response = await fetch("https://backend.buildpicoapps.com/aero/run/llm-api?pk=...", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt: userMessage })
        });

        if (!response.ok) {
            console.error("Error:", response.statusText);
            return "⚠️ Sorry, something went wrong.";
        }

        const data = await response.json();
        return data.status === "success" ? data.text : "⚠️ Error in response.";
    } catch (error) {
        console.error("Error:", error);
        return "⚠️ Could not connect. Try again.";
    }
}

chatForm.addEventListener("submit", async (event) => {
    event.preventDefault();

    const userMessage = userInput.value.trim();
    if (!userMessage) return;

    chatContent.appendChild(createMessageElement(userMessage, true));
    chatContent.scrollTop = chatContent.scrollHeight;

    userInput.value = "";
    userInput.focus();

    const loadingMessage = createMessageElement("Typing...", false);
    chatContent.appendChild(loadingMessage);
    chatContent.scrollTop = chatContent.scrollHeight;

    const botResponse = await fetchResponse(userMessage);
    loadingMessage.remove();

    chatContent.appendChild(createMessageElement(botResponse, false));
    chatContent.scrollTop = chatContent.scrollHeight;
});
</script>
